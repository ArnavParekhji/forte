sudo: required
language: python
dist: xenial
cache: pip
python:
- '3.6'
- '3.7'
env:
  matrix:
  - TORCH_VER="1.5.0" TENSORFLOW_VER="1.15.0" secure: CvtYarVdRJdoKU4MYmDu++pIJ5ANot1KxR1NXWAi0ONqULdZJdEONV2DdliP4xJlVoVto9brggyTCZLGaPcXo5Jii9j9fmvu45bg94JBdw/Tfvlb+zDlrU8FoWFYRSXolmGZJHmSQMLCSjuTbYlmMvP2e6ow+Uspw0gPHXcVpBrMECAx/ZQv0vx23Ho957swo95jJC5TD0PQVNYwPxnOqeefMg3QIoqL64DXL4uOO8ISjWKgk6waXxJE3TYklNoCWx2oYbFBiCK3/OB6AZw2LrHVFRGs06Iol0S3rEFmJ0O2sbvkPQJJlFABM0rdJV4tgha4Q0XU4iBVKdBSoNwcV2hKESdZ4d7eFJwsmkAOp5KAq7x1UJ2EDNpvrJqJ+ULAwv8/TlfF8rxjpptUY4VGiuWiHmHgmRvwlST5rQbQyONI5UObFlebV4j42sIioG9tgImgPV0w3eKl67rWOBCC7X/lxuyAoG9aVOtL3ty1V7S6NaXIsEji3dlf34aiMOXWdc9PqPB9zutOS+Z1zMlmXUm+i/3hNgONFVoPpYYvyqxMh2FcRcJp5QGm44R9sppMS7mIBij/kLAhe/zjIGerdzBFWsgWvbBg39BDrRuYj07mYv9bWjNpSf1Pe6zGs3PUV38YY7bRq5PkPu0I+g8FCPH+o9D24OUrD5zp3lWt5mc=
install:
- pip install --upgrade pip
- pip install --progress-bar off torch==$TORCH_VER
- pip install --progress-bar off tensorflow==$TENSORFLOW_VER
- pip install --progress-bar off .[nltk,ner,srl,txtgen,stanza,test,example,ir,wikipedia,spacy,sentiment,allennlp]
- git clone https://github.com/asyml/texar-pytorch.git
- cd texar-pytorch
- pip install --progress-bar off .
- cd ..
- rm -rf texar-pytorch
- wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.4.2-linux-x86_64.tar.gz
- tar -zxf elasticsearch-7.4.2-linux-x86_64.tar.gz
- rm -rf elasticsearch-7.4.2-linux-x86_64.tar.gz
- elasticsearch-7.4.2/bin/elasticsearch -d
- pip install faiss-cpu
- pip install pylint==2.5.2 flake8==3.8.2
- pip install mypy==0.780
- pip install pytest==5.1.3
- pip install coverage codecov
script:
- "./scripts/build_ontology_specs.sh"
- pylint forte/ examples/ ft/ scripts/ tests/
- flake8 forte/ examples/ ft/ scripts/ tests/
- mypy .
- spacy download en_core_web_sm
- spacy download xx_ent_wiki_sm
- python -m nltk.downloader punkt averaged_perceptron_tagger wordnet maxent_ne_chunker
  words
- export PYTHONPATH=`pwd`
- coverage run -m pytest
after_success:
- codecov
- "./scripts/travis_after_success.sh"
jobs:
  include:
  - stage: docs
    python: '3.7'
    install:
    - pip install --upgrade pip
    - pip install --progress-bar off -r requirements.txt
    - sudo apt-get install libenchant1c2a myspell-en-us
    - pip install --progress-bar off -r docs/requirements.txt
    - git clone https://github.com/asyml/texar-pytorch.git
    - cd texar-pytorch
    - pip install --progress-bar off .
    - cd ..
    - rm -rf texar-pytorch
    script:
    - cd docs
    - sphinx-build -W -b html -d _build/doctrees . _build/html
    - sphinx-build -b spelling -d _build/doctrees . _build/spelling
notifications:
  email: false
